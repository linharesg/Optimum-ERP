{% extends "base.html" %}
{% load static %}
{% load phone_filter %}

{% block title %}Clientes{% endblock  %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
<script src="{% static 'base/js/index.js' %}"></script>
{% endblock  %}

{% block content %}

<h2 class="mb-3">Clientes</h2>

<a 
  href="{% url "clients:create" %}" title="Cadastrar novo cliente"
  class="btn btn-primary btn-sticky-bottom">
  <i class="bi bi-plus"></i>
</a>

<!-- Filtro -->
<form method="get" action="{% url 'clients:search' %}" class="row mb-3">
  <div class="col">
    <input value="{{ request.GET.q }}" class="form-control" type="text" name="q" placeholder="Buscar" />
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-primary">Buscar</button>
  </div>
</form> 


<div class="table-responsive">
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <th>ID</th>
        <th>Razão Social</th>
        <th>Nome Fantasia</th>
        <th>Representante</th>
        <th>Email</th>
        <th>Telefone</th>
        <th>Ativo</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for client in page_obj %}
        <tr>
          <td>{{ client.id }}</td>
          <td>{{ client.company_name|title }}</td>
          <td>{{ client.fantasy_name|title }}</td>
          <td>{{ client.representative|title }}</td>
          <td>{{ client.email }}</td>
          <td>{{ client.phone|format_phone }}</td>
          <td>
            <input {% if client.enabled %}checked{% endif %} data-url="{% url 'clients:toggle_enabled' client.id %}" type="checkbox" class="form-check-input" />
          </td>
          <td class="d-flex gap-1">
            <a href="{% url 'clients:update' client.slug %}" class="btn btn-warning btn-sm" title="editar cliente"><i class="bi bi-pencil"></i></a>
            <form method="post" action="{% url 'clients:delete' client.id %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm" title="remover cliente"><i class="bi bi-trash"></i></button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center">Nenhum cliente cadastrado</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% include "partials/_paginator.html" %}
</div>
{% endblock  %}